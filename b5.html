<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রত্যয়নপত্র - বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap');

        @page {
            size: A4 landscape;
            margin: 0;
        }

        body { 
            font-family: 'Nikosh', 'NikoshBan', 'Hind Siliguri', sans-serif; 
            margin: 0; padding: 0; background-color: #f0f2f5;
        }
        
        .no-print { 
            background: #1a2a6c; padding: 15px; text-align: center;
            color: white; position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: center; align-items: center; gap: 15px;
        }

        select { padding: 10px; border-radius: 5px; font-family: inherit; min-width: 250px; outline: none; }
        .btn { padding: 10px 25px; color: white; border: none; cursor: pointer; border-radius: 6px; font-family: inherit; font-weight: bold; }
        .btn-print { background: #27ae60; }
        .btn-all { background: #e67e22; }

        #cert-area { display: flex; flex-direction: column; align-items: center; }

        .cert-container {
            width: 297mm; 
            height: 200mm; /* উচ্চতা কিছুটা কমানো হয়েছে অতিরিক্ত পেজ রোধ করতে */
            background: white;
            margin: 20px auto;
            border: 15px double #b8860b; 
            padding: 30px 80px;
            box-sizing: border-box;
            position: relative;
            background-image: radial-gradient(#fffdfa, #ffffff);
            transform-origin: top center;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            overflow: hidden; /* কন্টেন্ট বাইরে যাওয়া রোধ করবে */
        }

        @media screen and (max-width: 1300px) { #cert-area { zoom: 0.7; } }

        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 350px; opacity: 0.05; z-index: 0; }
        .content-wrapper { position: relative; z-index: 1; flex-grow: 1; }

        .header { display: flex; align-items: center; justify-content: space-between; border-bottom: 4px double #b8860b; padding-bottom: 10px; }
        .logo { width: 80px; height: auto; }
        .school-info h2 { margin: 2px 0; font-size: 38px; color: #c0392b; font-weight: 700; }
        .school-info h4 { margin: 0; font-size: 21px; color: #1a2a6c; }
        .school-info p { margin: 2px 0; font-size: 17px; }

        .meta { display: flex; justify-content: space-between; margin: 15px 0; font-size: 21px; font-weight: 600; }
        .cert-title { text-align: center; margin: 10px 0; }
        .cert-title span { background: #1a2a6c; color: white; padding: 6px 50px; font-size: 32px; border-radius: 10px; }

        .main-content { font-size: 27px; line-height: 2.0; margin-top: 15px; text-align: justify; color: #2c3e50; }
        .fill { border-bottom: 2px dotted #444; display: inline-block; padding: 0 8px; font-weight: 700; color: #000; }

        .footer { margin-top: auto; padding-bottom: 10px; display: flex; justify-content: flex-end; }
        .sign-box { text-align: center; width: 320px; }
        .line { border-top: 2.5px solid #1a2a6c; margin-bottom: 5px; }

        @media print {
            .no-print { display: none !important; }
            body { background: white; margin: 0; padding: 0; overflow: hidden; }
            #cert-area { zoom: 1 !important; }
            .cert-container { 
                margin: 0 !important; 
                width: 297mm !important;
                height: 210mm !important; /* প্রিন্টে ফুল সাইজ */
                border: 15px double #b8860b !important;
                box-shadow: none !important;
                page-break-after: always !important; /* শুধুমাত্র পেজের শেষে ব্রেক নেবে */
            }
            /* অতিরিক্ত ফাঁকা পেজ ডিটেকশন বন্ধ করা */
            html, body { height: 100%; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <strong>শিক্ষার্থী তালিকা:</strong>
    <select id="studentSelect" onchange="updateCert()">
        <option value="">ডেটা লোড হচ্ছে...</option>
    </select>
    <button class="btn btn-print" onclick="window.print()">প্রিন্ট করুন</button>
    <button class="btn btn-all" onclick="generateAll()">সবগুলো একসাথে PDF করুন</button>
</div>

<div id="cert-area">
    <h3 style="text-align:center; margin-top:100px; color:#1a2a6c;">অনুগ্রহ করে তালিকা থেকে শিক্ষার্থী নির্বাচন করুন</h3>
</div>

<script>
    const sheetURL = "https://script.google.com/macros/s/AKfycbzMkBGQDhWiogr2Xy4axVNwDES5bSi0EeBDXNgv3Qvb7POhmAYeBqUln3iUhumwYFLlUQ/exec";
    let studentsData = [];

    function toBn(n) { 
        if(!n) return "";
        return String(n).replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]); 
    }

    const today = new Date();
    const dateStr = toBn(`${String(today.getDate()).padStart(2, '0')}/${String(today.getMonth() + 1).padStart(2, '0')}/${today.getFullYear()}`);

    async function loadSheetData() {
        const select = document.getElementById('studentSelect');
        try {
            const response = await fetch(sheetURL);
            studentsData = await response.json();
            select.innerHTML = '<option value="">শিক্ষার্থী নির্বাচন করুন</option>';
            studentsData.forEach(s => {
                let opt = document.createElement('option');
                opt.value = s.roll;
                opt.innerHTML = `রোল: ${toBn(s.roll)} - ${s.name}`;
                select.appendChild(opt);
            });
        } catch (error) { console.error("Error:", error); }
    }

    function createCertHTML(s) {
        return `
        <div class="cert-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Government_Seal_of_Bangladesh.svg" class="watermark">
            <div class="content-wrapper">
                <div class="header">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Government_Seal_of_Bangladesh.svg" class="logo">
                    <div class="school-info">
                        <h4>গণপ্রজাতন্ত্রী বাংলাদেশ সরকার</h4>
                        <h4>প্রাথমিক শিক্ষা অধিদপ্তর</h4>
                        <h2>বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়</h2>
                        <p>বদরগঞ্জ, রংপুর। স্থাপিত: ১৯৯২ ইং</p>
                    </div>
                    <img src="https://dpe.portal.gov.bd/sites/default/files/files/dpe.portal.gov.bd/npfblock//DPE%20Logo.jpg" class="logo">
                </div>
                <div class="meta">
                    <div>সিরিয়াল নং: <span class="fill" style="min-width: 100px;">${toBn('২০২৫-'+s.roll)}</span></div>
                    <div>তারিখ: <span class="fill" style="min-width: 120px;">${dateStr}</span></div>
                </div>
                <div class="cert-title"><span>প্রত্যয়নপত্র</span></div>
                <div class="main-content">
                    এই মর্মে প্রত্যয়ন করা যাচ্ছে যে, <span class="fill" style="min-width: 380px;">${s.name}</span>, 
                    পিতা: <span class="fill" style="min-width: 250px;">${s.father}</span>, 
                    মাতা: <span class="fill" style="min-width: 250px;">${s.mother}</span>। 
                    তাহার জন্ম তারিখ: <span class="fill" style="min-width: 150px;">${toBn(s.dob)}</span>, 
                    রোল নং: <span class="fill" style="min-width: 60px;">${toBn(s.roll)}</span>। 
                    সে এই বিদ্যালয়ে <span class="fill">২০২৫</span> শিক্ষাবর্ষে <span class="fill">৫ম শ্রেণি</span>তে নিয়মিত অধ্যয়ন করেছে। তাহার স্বভাব ও চরিত্র প্রশংসনীয়। <br>
                    আমি তাহার সর্বাঙ্গীন সাফল্য ও উজ্জ্বল ভবিষ্যৎ কামনা করি।
                </div>
            </div>
            <div class="footer">
                <div class="sign-box">
                    <div class="line"></div>
                    <div class="sign-text" style="font-weight: 600; font-size: 19px; color: #1a2a6c;">
                        <strong>(প্রধান শিক্ষক)</strong><br>
                        বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়<br>
                        বদরগঞ্জ, রংপুর।
                    </div>
                </div>
            </div>
        </div>`;
    }

    function updateCert() {
        const rollVal = document.getElementById('studentSelect').value;
        const student = studentsData.find(s => s.roll == rollVal);
        if (student) document.getElementById('cert-area').innerHTML = createCertHTML(student);
    }

    function generateAll() {
        if(studentsData.length === 0) return alert("ডেটা লোড হয়নি!");
        let allHTML = "";
        studentsData.forEach(s => { allHTML += createCertHTML(s); });
        document.getElementById('cert-area').innerHTML = allHTML;
        setTimeout(() => { window.print(); }, 1000);
    }

    window.addEventListener('load', loadSheetData);
</script>
</body>
</html>
