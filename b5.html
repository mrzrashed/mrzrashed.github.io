<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রত্যয়নপত্র - বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap');

        @page { size: landscape; margin: 0; }
        body { font-family: 'Hind Siliguri', sans-serif; margin: 0; padding: 0; background-color: #f0f2f5; }
        
        .no-print { 
            background: #1a2a6c; padding: 15px; text-align: center;
            color: white; position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: center; align-items: center; gap: 10px;
        }

        select { padding: 8px; border-radius: 5px; font-family: 'Hind Siliguri'; border: 2px solid #f39c12; min-width: 220px; }

        .btn { padding: 10px 25px; color: white; border: none; cursor: pointer; border-radius: 6px; font-family: 'Hind Siliguri'; font-weight: bold; }
        .btn-print { background: #27ae60; }
        .btn-all { background: #e67e22; }

        /* সার্টিফিকেট ডিজাইন */
        /* সার্টিফিকেট কন্টেইনার আপডেট */
        .cert-container {
        width: 285mm; 
        height: 195mm; 
        background: white;
        margin: 20px auto; /* মার্জিন একটু কমানো হয়েছে */
        border: 15px double #b8860b; 
        padding: 30px 60px; /* প্যাডিং সামঞ্জস্য করা হয়েছে */
        box-sizing: border-box;
        position: relative;
        background-image: radial-gradient(#fffdfa, #ffffff);
        page-break-after: always;
        box-shadow: 0 0 20px rgba(0,0,0,0.1);
        
        /* নিচের লাইনগুলো স্ক্রিন ভিউ ঠিক করবে */
        transform-origin: top center;
        }
        
        /* স্ক্রিনে দেখার সময় জুম লেভেল ঠিক করার জন্য (প্রিন্টে এটি কাজ করবে না) */
        @media screen and (max-width: 1200px) {
        #cert-area {
            zoom: 0.7; /* স্ক্রিন ছোট হলে সার্টিফিকেট ৭০% ছোট হয়ে দেখাবে যাতে ভেঙে না যায় */
        }
        }
        
        @media screen and (max-width: 1600px) and (min-width: 1201px) {
        #cert-area {
            zoom: 0.85; /* মাঝারি স্ক্রিনে ৮৫% জুম */
        }
        }
        
        /* প্রিন্ট সেটিংস আগের মতোই থাকবে */
        @media print {
        #cert-area {
            zoom: 1 !important; /* প্রিন্টের সময় কোনো জুম হবে না */
        }
        .no-print { display: none; }
        body { background: white; margin: 0; }
        .cert-container { 
            margin: 0 !important; 
            width: 285mm !important;
            height: 195mm !important;
            border: 15px double #b8860b !important;
            box-shadow: none;
        }
        }

        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 320px; opacity: 0.05; z-index: 0; }
        .content-wrapper { position: relative; z-index: 1; }

        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; border-bottom: 3px double #b8860b; padding-bottom: 12px; }
        .logo { width: 80px; height: auto; }
        .school-info { text-align: center; flex: 1; }
        .school-info h2 { margin: 2px 0; font-size: 32px; color: #c0392b; font-weight: 700; }
        .school-info h4 { margin: 0; font-size: 19px; color: #1a2a6c; }
        .school-info p { margin: 2px 0; font-size: 16px; font-weight: 600; }

        .meta { display: flex; justify-content: space-between; margin: 20px 0; font-size: 19px; font-weight: 600; }
        .cert-title { text-align: center; margin: 20px 0; }
        .cert-title span { background: #1a2a6c; color: white; padding: 6px 55px; font-size: 28px; border-radius: 8px; font-weight: bold; }

        .main-content { font-size: 23px; line-height: 2.1; margin-top: 25px; text-align: justify; color: #2c3e50; }
        .fill { border-bottom: 2px dotted #444; display: inline-block; padding: 0 8px; font-weight: 700; color: #000; }

        .footer { margin-top: 50px; display: flex; justify-content: flex-end; }
        .sign-box { text-align: center; width: 280px; }
        .line { border-top: 2.5px solid #1a2a6c; margin-bottom: 5px; }

        @media print {
            .no-print { display: none; }
            body { background: white; }
            .cert-container { margin: 0 !important; width: 100%; height: 100vh; box-shadow: none; }
        }
    </style>
</head>
<body>

<div class="no-print">
    <strong>শিক্ষার্থী তালিকা:</strong>
    <select id="studentSelect" onchange="updateCert()">
        <option value="">ডেটা লোড হচ্ছে...</option>
    </select>
    <button class="btn btn-print" onclick="window.print()">প্রিন্ট করুন</button>
    <button class="btn btn-all" onclick="generateAll()">সবগুলো একসাথে PDF করুন</button>
</div>

<div id="cert-area">
    </div>

<script>
    // আপনার গুগল অ্যাপস স্ক্রিপ্ট লিঙ্ক
    const sheetURL = "https://script.google.com/macros/s/AKfycbzMkBGQDhWiogr2Xy4axVNwDES5bSi0EeBDXNgv3Qvb7POhmAYeBqUln3iUhumwYFLlUQ/exec";

    let studentsData = [];

    function toBn(n) { 
        if(!n) return "";
        return String(n).replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]); 
    }

    const today = new Date();
    const dateStr = toBn(`${String(today.getDate()).padStart(2, '0')}/${String(today.getMonth() + 1).padStart(2, '0')}/${today.getFullYear()}`);

    // এই ফাংশনটি গুগল শিট থেকে ডেটা নিয়ে আসবে
    async function loadSheetData() {
        const select = document.getElementById('studentSelect');
        try {
            const response = await fetch(sheetURL);
            studentsData = await response.json();
            
            select.innerHTML = '<option value="">শিক্ষার্থী নির্বাচন করুন</option>';
            studentsData.forEach(s => {
                let opt = document.createElement('option');
                opt.value = s.roll;
                opt.innerHTML = `রোল: ${toBn(s.roll)} - ${s.name}`;
                select.appendChild(opt);
            });

            if(studentsData.length > 0) {
                console.log('loaded success');
            }
        } catch (error) {
            console.error("Error:", error);
            alert("ডেটা লোড করতে ব্যর্থ হয়েছে। নিশ্চিত করুন গুগল স্ক্রিপ্টে Anyone এক্সেস দেওয়া আছে।");
        }
    }

    function createCertHTML(s) {
        return `
        <div class="cert-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Government_Seal_of_Bangladesh.svg" class="watermark">
            <div class="content-wrapper">
                <div class="header">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Government_Seal_of_Bangladesh.svg" class="logo">
                    <div class="school-info">
                        <h4>গণপ্রজাতন্ত্রী বাংলাদেশ সরকার</h4>
                        <h4>প্রাথমিক শিক্ষা অধিদপ্তর</h4>
                        <h2>বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়</h2>
                        <p>বদরগঞ্জ, রংপুর। স্থাপিত: ১৯৯২ ইং</p>
                    </div>
                    <img src="https://dpe.portal.gov.bd/sites/default/files/files/dpe.portal.gov.bd/npfblock//DPE%20Logo.jpg" class="logo">
                </div>
                <div class="meta">
                    <div>সিরিয়াল নং: <span class="fill" style="min-width: 100px;">${toBn('২০২৫-'+s.roll)}</span></div>
                    <div>তারিখ: <span class="fill" style="min-width: 120px;">${dateStr}</span></div>
                </div>
                <div class="cert-title"><span>প্রত্যয়নপত্র</span></div>
                <div class="main-content">
                    এই মর্মে প্রত্যয়ন করা যাচ্ছে যে, <span class="fill" style="min-width: 380px;">${s.name}</span>, 
                    পিতা: <span class="fill" style="min-width: 250px;">${s.father}</span>, 
                    মাতা: <span class="fill" style="min-width: 250px;">${s.mother}</span>। 
                    তাহার জন্ম তারিখ: <span class="fill" style="min-width: 150px;">${toBn(s.dob)}</span>, 
                    রোল নং: <span class="fill" style="min-width: 60px;">${toBn(s.roll)}</span>। 
                    সে এই বিদ্যালয়ে <span class="fill">২০২৫</span> শিক্ষাবর্ষে <span class="fill">৫ম শ্রেণি</span>তে নিয়মিত অধ্যয়ন করেছে। তাহার স্বভাব ও চরিত্র প্রশংসনীয়। <br>
                    আমি তাহার সর্বাঙ্গীন সাফল্য ও উজ্জ্বল ভবিষ্যৎ কামনা করি।
                </div>
                <div class="footer">
                    <div class="sign-box">
                        <div class="line"></div>
                        <div class="sign-text" style="font-weight: 600; font-size: 17px; color: #1a2a6c;">
                            <strong>(প্রধান শিক্ষক)</strong><br>
                            বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়<br>
                            বদরগঞ্জ, রংপুর।
                        </div>
                    </div>
                </div>
            </div>
        </div>`;
    }

    function renderCert(student) {
        document.getElementById('cert-area').innerHTML = createCertHTML(student);
    }

    function updateCert() {
        const rollVal = document.getElementById('studentSelect').value;
        const student = studentsData.find(s => s.roll == rollVal);
        if (student) renderCert(student);
    }

    function generateAll() {
        if(studentsData.length === 0) return alert("ডেটা লোড হয়নি!");
        let allHTML = "";
        studentsData.forEach(s => { allHTML += createCertHTML(s); });
        document.getElementById('cert-area').innerHTML = allHTML;
        setTimeout(() => { window.print(); }, 1000);
    }

    // পেজ লোড হওয়ার সাথে সাথে ডেটা নিয়ে আসবে
    window.addEventListener('load', loadSheetData);
</script>
</body>
</html>
