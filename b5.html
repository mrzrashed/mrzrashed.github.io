<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>প্রত্যয়নপত্র - বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap');

        /* প্রিন্ট সেটিংস: A4 Landscape এর জন্য নির্ধারিত */
        @page {
            size: A4 landscape;
            margin: 0;
        }

        body { 
            font-family: 'Hind Siliguri', sans-serif; 
            margin: 0; padding: 0; background-color: #f0f2f5;
        }
        
        /* উপরের নেভিগেশন বার */
        .no-print { 
            background: #1a2a6c; padding: 15px; text-align: center;
            color: white; position: sticky; top: 0; z-index: 1000;
            display: flex; justify-content: center; align-items: center; gap: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        select { 
            padding: 10px; border-radius: 5px; font-family: 'Hind Siliguri'; 
            border: 2px solid #f39c12; min-width: 250px; outline: none;
        }

        .btn {
            padding: 10px 25px; color: white; border: none; 
            cursor: pointer; border-radius: 6px; font-family: 'Hind Siliguri'; 
            font-weight: bold; transition: 0.3s;
        }
        .btn-print { background: #27ae60; }
        .btn-all { background: #e67e22; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.2); }

        /* সার্টিফিকেট কন্টেইনার এবং স্ক্রিন জুম কন্ট্রোল */
        #cert-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 50px;
        }

        .cert-container {
            /* A4 Landscape এর একদম সঠিক মাপ */
            width: 297mm; 
            height: 210mm; 
            background: white;
            margin: 30px auto;
            border: 15px double #b8860b; 
            padding: 40px 80px;
            box-sizing: border-box;
            position: relative;
            background-image: radial-gradient(#fffdfa, #ffffff);
            page-break-after: always;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            transform-origin: top center;
        }

        /* বিভিন্ন স্ক্রিন রেজোলিউশনে ডিজাইন ঠিক রাখার জন্য জুম লজিক */
        @media screen and (max-width: 1300px) {
            #cert-area { zoom: 0.75; }
        }
        @media screen and (max-width: 1000px) {
            #cert-area { zoom: 0.6; }
        }

        /* ভেতরের কন্টেন্ট ডিজাইন */
        .watermark {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); width: 350px;
            opacity: 0.05; z-index: 0;
        }

        .content-wrapper { position: relative; z-index: 1; }

        .header { 
            display: flex; align-items: center; justify-content: space-between; 
            margin-bottom: 15px; border-bottom: 4px double #b8860b; padding-bottom: 15px; 
        }

        .logo { width: 85px; height: auto; }
        .school-info { text-align: center; flex: 1; }
        .school-info h2 { margin: 2px 0; font-size: 36px; color: #c0392b; font-weight: 700; }
        .school-info h4 { margin: 0; font-size: 20px; color: #1a2a6c; }
        .school-info p { margin: 2px 0; font-size: 16px; font-weight: 600; }

        .meta { display: flex; justify-content: space-between; margin: 25px 0; font-size: 20px; font-weight: 600; }
        
        .cert-title { text-align: center; margin: 25px 0; }
        .cert-title span { 
            background: #1a2a6c; color: white; padding: 8px 60px; 
            font-size: 30px; border-radius: 10px; font-weight: bold;
        }

        .main-content { 
            font-size: 25px; line-height: 2.3; margin-top: 30px; 
            text-align: justify; color: #2c3e50;
        }

        .fill { border-bottom: 2px dotted #444; display: inline-block; padding: 0 8px; font-weight: 700; color: #000; }

        .footer { margin-top: 60px; display: flex; justify-content: flex-end; }
        .sign-box { text-align: center; width: 300px; }
        .line { border-top: 2.5px solid #1a2a6c; margin-bottom: 5px; }

        /* প্রিন্টের সময় সব জুম বন্ধ করে ফুল পেজ করা */
        @media print {
            .no-print { display: none !important; }
            body { background: white; margin: 0; padding: 0; }
            #cert-area { zoom: 1 !important; transform: scale(1) !important; }
            .cert-container { 
                margin: 0 !important; 
                width: 297mm !important;
                height: 210mm !important;
                border: 15px double #b8860b !important;
                box-shadow: none !important;
            }
        }
    </style>
</head>
<body>

<div class="no-print">
    <strong>শিক্ষার্থী তালিকা:</strong>
    <select id="studentSelect" onchange="updateCert()">
        <option value="">ডেটা লোড হচ্ছে...</option>
    </select>
    <button class="btn btn-print" onclick="window.print()">প্রিন্ট করুন</button>
    <button class="btn btn-all" onclick="generateAll()">সবগুলো একসাথে PDF করুন</button>
</div>

<div id="cert-area">
    <h3 style="text-align:center; margin-top:100px; color:#1a2a6c;">অনুগ্রহ করে তালিকা থেকে শিক্ষার্থী নির্বাচন করুন</h3>
</div>

<script>
    // আপনার গুগল অ্যাপস স্ক্রিপ্ট লিঙ্ক
    const sheetURL = "https://script.google.com/macros/s/AKfycbzMkBGQDhWiogr2Xy4axVNwDES5bSi0EeBDXNgv3Qvb7POhmAYeBqUln3iUhumwYFLlUQ/exec";

    let studentsData = [];

    // সংখ্যা বাংলায় রূপান্তর
    function toBn(n) { 
        if(!n) return "";
        return String(n).replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]); 
    }

    // আজকের তারিখ বাংলায়
    const today = new Date();
    const dateStr = toBn(`${String(today.getDate()).padStart(2, '0')}/${String(today.getMonth() + 1).padStart(2, '0')}/${today.getFullYear()}`);

    // গুগল শিট থেকে তথ্য নিয়ে আসা
    async function loadSheetData() {
        const select = document.getElementById('studentSelect');
        try {
            const response = await fetch(sheetURL);
            studentsData = await response.json();
            
            select.innerHTML = '<option value="">শিক্ষার্থী নির্বাচন করুন</option>';
            studentsData.forEach(s => {
                let opt = document.createElement('option');
                opt.value = s.roll;
                opt.innerHTML = `রোল: ${toBn(s.roll)} - ${s.name}`;
                select.appendChild(opt);
            });
            // ডিফল্ট কোনো কন্টেন্ট শুরুতে লোড হবে না।
        } catch (error) {
            console.error("Error fetching data:", error);
            alert("গুগল শিট থেকে ডেটা লোড করা সম্ভব হয়নি। শিট বা ইন্টারনেট চেক করুন।");
        }
    }

    // সার্টিফিকেট টেমপ্লেট ফাংশন
    function createCertHTML(s) {
        return `
        <div class="cert-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Government_Seal_of_Bangladesh.svg" class="watermark">
            <div class="content-wrapper">
                <div class="header">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/8/84/Government_Seal_of_Bangladesh.svg" class="logo">
                    <div class="school-info">
                        <h4>গণপ্রজাতন্ত্রী বাংলাদেশ সরকার</h4>
                        <h4>প্রাথমিক শিক্ষা অধিদপ্তর</h4>
                        <h2>বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়</h2>
                        <p>বদরগঞ্জ, রংপুর। স্থাপিত: ১৯৯২ ইং</p>
                    </div>
                    <img src="https://dpe.portal.gov.bd/sites/default/files/files/dpe.portal.gov.bd/npfblock//DPE%20Logo.jpg" class="logo">
                </div>
                <div class="meta">
                    <div>সিরিয়াল নং: <span class="fill" style="min-width: 120px;">${toBn('২০২৫-'+s.roll)}</span></div>
                    <div>তারিখ: <span class="fill" style="min-width: 130px;">${dateStr}</span></div>
                </div>
                <div class="cert-title"><span>প্রত্যয়নপত্র</span></div>
                <div class="main-content">
                    এই মর্মে প্রত্যয়ন করা যাচ্ছে যে, <span class="fill" style="min-width: 380px;">${s.name}</span>, 
                    পিতা: <span class="fill" style="min-width: 300px;">${s.father}</span>, 
                    মাতা: <span class="fill" style="min-width: 300px;">${s.mother}</span>। 
                    তাহার জন্ম তারিখ: <span class="fill" style="min-width: 180px;">${toBn(s.dob)}</span>, 
                    রোল নং: <span class="fill" style="min-width: 80px;">${toBn(s.roll)}</span>। 
                    সে এই বিদ্যালয়ে <span class="fill">২০২৫</span> শিক্ষাবর্ষে <span class="fill">৫ম শ্রেণি</span>তে নিয়মিত অধ্যয়ন করেছে। তাহার স্বভাব ও চরিত্র প্রশংসনীয়। <br>
                    আমি তাহার সর্বাঙ্গীন সাফল্য ও উজ্জ্বল ভবিষ্যৎ কামনা করি।
                </div>
                <div class="footer">
                    <div class="sign-box">
                        <div class="line"></div>
                        <div class="sign-text" style="font-weight: 600; font-size: 18px; color: #1a2a6c;">
                            <strong>(প্রধান শিক্ষক)</strong><br>
                            বুজরুক বাগবাড় সরকারি প্রাথমিক বিদ্যালয়<br>
                            বদরগঞ্জ, রংপুর।
                        </div>
                    </div>
                </div>
            </div>
        </div>`;
    }

    // সিলেকশন চেঞ্জ হলে ভিউ আপডেট
    function updateCert() {
        const rollVal = document.getElementById('studentSelect').value;
        const student = studentsData.find(s => s.roll == rollVal);
        if (student) {
            document.getElementById('cert-area').innerHTML = createCertHTML(student);
        }
    }

    // সব শিক্ষার্থীর সার্টিফিকেট একসাথে জেনারেট
    function generateAll() {
        if(studentsData.length === 0) return alert("ডেটা লোড হয়নি!");
        let allHTML = "";
        studentsData.forEach(s => {
            allHTML += createCertHTML(s);
        });
        document.getElementById('cert-area').innerHTML = allHTML;
        setTimeout(() => { window.print(); }, 1000);
    }

    // উইন্ডো লোড হলে ডেটা আনা শুরু করো
    window.addEventListener('load', loadSheetData);
</script>
</body>
</html>
